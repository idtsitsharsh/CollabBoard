{"ast":null,"code":"var _jsxFileName = \"F:\\\\Open Project'25\\\\MARS Open Project\\\\Collaborative-whiteboard-with-real-time-drawing\\\\frontend\\\\src\\\\components\\\\Whiteboard.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { useSocket } from '../context/SocketContext';\nimport Toolbar from './Toolbar';\nimport Sidebar from './Sidebar';\nimport Canvas from './Canvas';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WhiteboardContainer = styled.div`\n  height: 100vh;\n  position: relative;\n  background: linear-gradient(135deg, #f8fdf8, #d4edda);\n  overflow: hidden;\n  padding-left: 160px;\n`;\n_c = WhiteboardContainer;\nconst MainContent = styled.div`\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  position: relative;\n`;\n_c2 = MainContent;\nconst Header = styled.div`\n  background: #ffffff;\n  padding: 10px 16px; /* reduced */\n  border-bottom: 2px solid #c3e6cb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n\n  @media (max-width: 768px) {\n    flex-direction: column;\n    gap: 8px;\n    align-items: stretch;\n  }\n`;\n_c3 = Header;\nconst RoomInfo = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 6px;\n\n  @media (max-width: 768px) {\n    align-items: center;\n    text-align: center;\n    width: 100%;\n  }\n`;\n_c4 = RoomInfo;\nconst RoomTitle = styled.h2`\n  color: #155724;\n  font-size: 1.25rem; /* slightly smaller */\n  font-weight: 600;\n  margin: 0;\n`;\n_c5 = RoomTitle;\nconst RoomSubtitle = styled.p`\n  color: #3c763d;\n  font-size: 0.85rem; /* reduced */\n  margin: 0;\n  font-style: italic;\n`;\n_c6 = RoomSubtitle;\nconst UserCount = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 0.85rem;\n  color: #2f5f3c;\n  font-weight: 500;\n  margin-top: 2px;\n`;\n_c7 = UserCount;\nconst UserDot = styled.div`\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  background: #28a745;\n`;\n_c8 = UserDot;\nconst HeaderActions = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n\n  @media (max-width: 768px) {\n    justify-content: center;\n    flex-wrap: wrap;\n    margin-top: 12px;\n  }\n`;\n_c9 = HeaderActions;\nconst Button = styled.button`\n  padding: 8px 16px;\n  border: none;\n  border-radius: 6px;\n  font-size: 0.9rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  @media (max-width: 768px) {\n    padding: 6px 12px;\n    font-size: 0.8rem;\n    min-width: 80px;\n  }\n\n  &.primary {\n    background: linear-gradient(135deg, #28a745, #218838);\n    color: white;\n\n    &:hover {\n      background: #218838;\n    }\n  }\n\n  &.secondary {\n    background: #f0fff4;\n    color: #155724;\n    border: 1px solid #c3e6cb;\n\n    &:hover {\n      background: #e2f6e9;\n    }\n  }\n\n  &.danger {\n    background: #dc3545;\n    color: white;\n\n    &:hover {\n      background: #c82333;\n    }\n  }\n`;\n_c0 = Button;\nconst CanvasContainer = styled.div`\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #ffffff;\n`;\n_c1 = CanvasContainer;\nconst LoadingOverlay = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(212, 237, 218, 0.95);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n`;\n_c10 = LoadingOverlay;\nconst LoadingText = styled.div`\n  color: #155724;\n  font-size: 1.1rem;\n`;\n_c11 = LoadingText;\nconst SidebarOverlay = styled.div`\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: min(300px, 90vw);\n  height: 100vh;\n  background: #ffffff;\n  border-left: 1px solid #c3e6cb;\n  box-shadow: -2px 0 8px rgba(0,0,0,0.15);\n  transition: transform 0.3s ease-in-out, opacity 0.3s;\n  z-index: 1000;\n  overflow: hidden;\n  touch-action: pan-y;\n  transform: ${({\n  $show\n}) => $show ? 'translateX(0)' : 'translateX(100%)'};\n  opacity: ${({\n  $show\n}) => $show ? 1 : 0};\n  pointer-events: ${({\n  $show\n}) => $show ? 'auto' : 'none'};\n\n  @media (max-width: 768px) {\n    width: 100vw;\n    right: 0;\n    transform: ${({\n  $show\n}) => $show ? 'translateX(0)' : 'translateX(100vw)'};\n  }\n`;\n_c12 = SidebarOverlay;\nconst Backdrop = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n  opacity: ${props => props.$show ? '1' : '0'};\n  visibility: ${props => props.$show ? 'visible' : 'hidden'};\n  transition: all 0.3s ease-in-out;\n  z-index: 999;\n`;\n_c13 = Backdrop;\nconst RedDot = styled.span`\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  background: #dc3545;\n  border-radius: 50%;\n  margin-left: 6px;\n  vertical-align: middle;\n`;\n_c14 = RedDot;\nconst ChatIcon = () => /*#__PURE__*/_jsxDEV(\"svg\", {\n  width: \"24\",\n  height: \"24\",\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M4 20V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H7l-3 3z\",\n    stroke: \"#28a745\",\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    fill: \"#fff\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 220,\n    columnNumber: 5\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 219,\n  columnNumber: 3\n}, this);\n_c15 = ChatIcon;\nfunction Whiteboard() {\n  _s();\n  const {\n    roomId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    socket,\n    isConnected,\n    currentRoom,\n    users,\n    joinRoom,\n    leaveRoom,\n    sendDraw,\n    clearCanvas,\n    undo,\n    redo,\n    socketReady\n  } = useSocket();\n  const [isLoading, setIsLoading] = useState(true);\n  const [showSidebar, setShowSidebar] = useState(false);\n  const [currentUsername, setCurrentUsername] = useState('');\n  const [drawingSettings, setDrawingSettings] = useState({\n    tool: 'pen',\n    color: '#000000',\n    brushSize: 2,\n    opacity: 1\n  });\n  const [pendingPassword, setPendingPassword] = useState(null);\n  const [joinTried, setJoinTried] = useState(false);\n  const canvasRef = useRef(null);\n  const [remoteDrawEvent, setRemoteDrawEvent] = useState(null);\n  const [touchStart, setTouchStart] = useState(null);\n  const hasJoinedRef = useRef(false);\n  const [hasUnreadMessages, setHasUnreadMessages] = useState(false);\n  useEffect(() => {\n    if (!socket) return;\n    const handleJoinError = error => {\n      if (error.message === 'Incorrect password' || error.message === 'Password required') {\n        let password = '';\n        while (!password) {\n          password = window.prompt('Enter room password:');\n          if (password === null) return navigate('/');\n        }\n        setPendingPassword(password);\n        setJoinTried(false);\n        hasJoinedRef.current = false;\n      } else {\n        alert(error.message);\n        navigate('/');\n      }\n    };\n    socket.on('join-error', handleJoinError);\n    return () => socket.off('join-error', handleJoinError);\n  }, [socket, navigate]);\n  useEffect(() => {\n    if (isConnected && roomId && socketReady && !hasJoinedRef.current && !joinTried) {\n      let username = localStorage.getItem('username') || `User${Math.floor(Math.random() * 1000)}`;\n      localStorage.setItem('username', username);\n      setCurrentUsername(username);\n      const isPrivate = !!pendingPassword;\n      joinRoom(roomId, username, isPrivate, pendingPassword || '');\n      setIsLoading(false);\n      hasJoinedRef.current = true;\n      setJoinTried(true);\n    }\n  }, [isConnected, roomId, joinRoom, socketReady, pendingPassword, joinTried]);\n  useEffect(() => {\n    if (socket) {\n      socket.on('draw', handleRemoteDraw);\n      socket.on('stroke', handleRemoteDraw);\n      socket.on('clear-canvas', handleRemoteClear);\n      socket.on('canvas-data', handleRemoteCanvasData);\n      return () => {\n        socket.off('draw');\n        socket.off('stroke');\n        socket.off('clear-canvas');\n        socket.off('canvas-data');\n      };\n    }\n  }, [socket]);\n  useEffect(() => {\n    if (socket && currentRoom !== null && currentRoom !== void 0 && currentRoom.roomId) {\n      socket.emit('request-canvas', {\n        roomId: currentRoom.roomId\n      });\n    }\n  }, [socket, currentRoom]);\n  useEffect(() => {\n    if (showSidebar && hasUnreadMessages) {\n      setHasUnreadMessages(false);\n    }\n  }, [showSidebar, hasUnreadMessages]);\n  useEffect(() => {\n    const handleBeforeUnload = () => leaveRoom();\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\n  }, [leaveRoom]);\n  const handleRemoteDraw = data => setRemoteDrawEvent(data);\n  const handleRemoteClear = () => {\n    var _canvasRef$current;\n    return (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.clear();\n  };\n  const handleRemoteCanvasData = ({\n    canvasData\n  }) => {\n    var _canvasRef$current2;\n    return (_canvasRef$current2 = canvasRef.current) === null || _canvasRef$current2 === void 0 ? void 0 : _canvasRef$current2.loadImageFromDataUrl(canvasData || '');\n  };\n  const handleDrawEvent = drawData => sendDraw({\n    ...drawData,\n    roomId: (currentRoom === null || currentRoom === void 0 ? void 0 : currentRoom.roomId) || roomId\n  });\n  const handleClearCanvas = () => clearCanvas((currentRoom === null || currentRoom === void 0 ? void 0 : currentRoom.roomId) || roomId);\n  const handleUndo = () => undo((currentRoom === null || currentRoom === void 0 ? void 0 : currentRoom.roomId) || roomId);\n  const handleRedo = () => redo((currentRoom === null || currentRoom === void 0 ? void 0 : currentRoom.roomId) || roomId);\n  const handleExportImage = async () => {\n    if (canvasRef.current) {\n      try {\n        const dataUrl = canvasRef.current.exportImage();\n        const link = document.createElement('a');\n        link.download = `whiteboard-${roomId}-${new Date().toISOString().slice(0, 10)}.png`;\n        link.href = dataUrl;\n        link.click();\n      } catch (err) {\n        console.error(err);\n        alert('Failed to export image');\n      }\n    }\n  };\n  const handleExportPDF = async () => {\n    if (canvasRef.current) {\n      try {\n        const pdf = await canvasRef.current.exportPDF();\n        pdf.save(`whiteboard-${roomId}-${new Date().toISOString().slice(0, 10)}.pdf`);\n      } catch (err) {\n        console.error(err);\n        alert('Failed to export PDF');\n      }\n    }\n  };\n  const handleLeaveRoom = () => leaveRoom(() => setTimeout(() => navigate('/'), 0));\n  const copyRoomLink = () => {\n    navigator.clipboard.writeText(`${window.location.origin}/whiteboard/${roomId}`);\n    alert('Room link copied to clipboard!');\n  };\n  const handleTouchStart = e => setTouchStart(e.touches[0].clientX);\n  const handleTouchMove = e => {\n    if (!touchStart) return;\n    if (touchStart - e.touches[0].clientX > 50) {\n      setShowSidebar(false);\n      setTouchStart(null);\n    }\n  };\n  const handleTouchEnd = () => setTouchStart(null);\n  const handleNewSidebarMessage = () => !showSidebar && setHasUnreadMessages(true);\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(LoadingOverlay, {\n      children: /*#__PURE__*/_jsxDEV(LoadingText, {\n        children: \"Connecting to room...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(WhiteboardContainer, {\n    children: [/*#__PURE__*/_jsxDEV(MainContent, {\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        children: [/*#__PURE__*/_jsxDEV(RoomInfo, {\n          children: [/*#__PURE__*/_jsxDEV(RoomTitle, {\n            children: \"CollabBoard\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 387,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(RoomSubtitle, {\n            children: \"Brainstorm. Sketch. Build\\u2014Together.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(UserCount, {\n            children: [/*#__PURE__*/_jsxDEV(UserDot, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 389,\n              columnNumber: 24\n            }, this), \" \", (users === null || users === void 0 ? void 0 : users.length) || 0, \" Users Online\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 389,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 386,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(HeaderActions, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            className: \"secondary\",\n            style: {\n              position: 'relative',\n              padding: '8px',\n              borderRadius: '50%',\n              width: 40,\n              height: 40,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center'\n            },\n            onClick: () => setShowSidebar(!showSidebar),\n            \"aria-label\": showSidebar ? 'Hide chat' : 'Show chat',\n            children: [/*#__PURE__*/_jsxDEV(ChatIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 401,\n              columnNumber: 15\n            }, this), !showSidebar && hasUnreadMessages && /*#__PURE__*/_jsxDEV(RedDot, {\n              style: {\n                position: 'absolute',\n                bottom: 4,\n                right: 4\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 403,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 393,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            className: \"secondary\",\n            onClick: copyRoomLink,\n            children: \"Share\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            className: \"danger\",\n            onClick: handleLeaveRoom,\n            children: \"Leave Room\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 407,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 392,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CanvasContainer, {\n        children: /*#__PURE__*/_jsxDEV(Canvas, {\n          ref: canvasRef,\n          tool: drawingSettings.tool,\n          color: drawingSettings.color,\n          brushSize: drawingSettings.brushSize,\n          opacity: drawingSettings.opacity,\n          onDrawEvent: handleDrawEvent,\n          remoteDrawEvent: remoteDrawEvent\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Toolbar, {\n        settings: drawingSettings,\n        onSettingsChange: setDrawingSettings,\n        onClear: handleClearCanvas,\n        onUndo: handleUndo,\n        onRedo: handleRedo,\n        onExportImage: handleExportImage,\n        onExportPDF: handleExportPDF\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 423,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SidebarOverlay, {\n      $show: showSidebar,\n      onTouchStart: handleTouchStart,\n      onTouchMove: handleTouchMove,\n      onTouchEnd: handleTouchEnd,\n      children: /*#__PURE__*/_jsxDEV(Sidebar, {\n        users: users,\n        roomId: roomId,\n        currentUsername: currentUsername,\n        onClose: () => setShowSidebar(false),\n        onNewMessage: handleNewSidebarMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 434,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Backdrop, {\n      $show: showSidebar,\n      onClick: () => setShowSidebar(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 449,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 383,\n    columnNumber: 5\n  }, this);\n}\n_s(Whiteboard, \"1RvU0e6dJSBYxyO4ovCem7fa3oU=\", false, function () {\n  return [useParams, useNavigate, useSocket];\n});\n_c16 = Whiteboard;\nexport default Whiteboard;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c0, _c1, _c10, _c11, _c12, _c13, _c14, _c15, _c16;\n$RefreshReg$(_c, \"WhiteboardContainer\");\n$RefreshReg$(_c2, \"MainContent\");\n$RefreshReg$(_c3, \"Header\");\n$RefreshReg$(_c4, \"RoomInfo\");\n$RefreshReg$(_c5, \"RoomTitle\");\n$RefreshReg$(_c6, \"RoomSubtitle\");\n$RefreshReg$(_c7, \"UserCount\");\n$RefreshReg$(_c8, \"UserDot\");\n$RefreshReg$(_c9, \"HeaderActions\");\n$RefreshReg$(_c0, \"Button\");\n$RefreshReg$(_c1, \"CanvasContainer\");\n$RefreshReg$(_c10, \"LoadingOverlay\");\n$RefreshReg$(_c11, \"LoadingText\");\n$RefreshReg$(_c12, \"SidebarOverlay\");\n$RefreshReg$(_c13, \"Backdrop\");\n$RefreshReg$(_c14, \"RedDot\");\n$RefreshReg$(_c15, \"ChatIcon\");\n$RefreshReg$(_c16, \"Whiteboard\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useParams","useNavigate","styled","useSocket","Toolbar","Sidebar","Canvas","jsxDEV","_jsxDEV","WhiteboardContainer","div","_c","MainContent","_c2","Header","_c3","RoomInfo","_c4","RoomTitle","h2","_c5","RoomSubtitle","p","_c6","UserCount","_c7","UserDot","_c8","HeaderActions","_c9","Button","button","_c0","CanvasContainer","_c1","LoadingOverlay","_c10","LoadingText","_c11","SidebarOverlay","$show","_c12","Backdrop","props","_c13","RedDot","span","_c14","ChatIcon","width","height","viewBox","fill","children","d","stroke","strokeWidth","strokeLinecap","strokeLinejoin","fileName","_jsxFileName","lineNumber","columnNumber","_c15","Whiteboard","_s","roomId","navigate","socket","isConnected","currentRoom","users","joinRoom","leaveRoom","sendDraw","clearCanvas","undo","redo","socketReady","isLoading","setIsLoading","showSidebar","setShowSidebar","currentUsername","setCurrentUsername","drawingSettings","setDrawingSettings","tool","color","brushSize","opacity","pendingPassword","setPendingPassword","joinTried","setJoinTried","canvasRef","remoteDrawEvent","setRemoteDrawEvent","touchStart","setTouchStart","hasJoinedRef","hasUnreadMessages","setHasUnreadMessages","handleJoinError","error","message","password","window","prompt","current","alert","on","off","username","localStorage","getItem","Math","floor","random","setItem","isPrivate","handleRemoteDraw","handleRemoteClear","handleRemoteCanvasData","emit","handleBeforeUnload","addEventListener","removeEventListener","data","_canvasRef$current","clear","canvasData","_canvasRef$current2","loadImageFromDataUrl","handleDrawEvent","drawData","handleClearCanvas","handleUndo","handleRedo","handleExportImage","dataUrl","exportImage","link","document","createElement","download","Date","toISOString","slice","href","click","err","console","handleExportPDF","pdf","exportPDF","save","handleLeaveRoom","setTimeout","copyRoomLink","navigator","clipboard","writeText","location","origin","handleTouchStart","e","touches","clientX","handleTouchMove","handleTouchEnd","handleNewSidebarMessage","length","className","style","position","padding","borderRadius","display","alignItems","justifyContent","onClick","bottom","right","ref","onDrawEvent","settings","onSettingsChange","onClear","onUndo","onRedo","onExportImage","onExportPDF","onTouchStart","onTouchMove","onTouchEnd","onClose","onNewMessage","_c16","$RefreshReg$"],"sources":["F:/Open Project'25/MARS Open Project/Collaborative-whiteboard-with-real-time-drawing/frontend/src/components/Whiteboard.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport styled from 'styled-components';\r\nimport { useSocket } from '../context/SocketContext';\r\nimport Toolbar from './Toolbar';\r\nimport Sidebar from './Sidebar';\r\nimport Canvas from './Canvas';\r\n\r\nconst WhiteboardContainer = styled.div`\r\n  height: 100vh;\r\n  position: relative;\r\n  background: linear-gradient(135deg, #f8fdf8, #d4edda);\r\n  overflow: hidden;\r\n  padding-left: 160px;\r\n`;\r\n\r\nconst MainContent = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  position: relative;\r\n`;\r\n\r\nconst Header = styled.div`\r\n  background: #ffffff;\r\n  padding: 10px 16px; /* reduced */\r\n  border-bottom: 2px solid #c3e6cb;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\r\n\r\n  @media (max-width: 768px) {\r\n    flex-direction: column;\r\n    gap: 8px;\r\n    align-items: stretch;\r\n  }\r\n`;\r\n\r\nconst RoomInfo = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n  gap: 6px;\r\n\r\n  @media (max-width: 768px) {\r\n    align-items: center;\r\n    text-align: center;\r\n    width: 100%;\r\n  }\r\n`;\r\n\r\nconst RoomTitle = styled.h2`\r\n  color: #155724;\r\n  font-size: 1.25rem; /* slightly smaller */\r\n  font-weight: 600;\r\n  margin: 0;\r\n`;\r\n\r\n\r\nconst RoomSubtitle = styled.p`\r\n  color: #3c763d;\r\n  font-size: 0.85rem; /* reduced */\r\n  margin: 0;\r\n  font-style: italic;\r\n`;\r\n\r\nconst UserCount = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 6px;\r\n  font-size: 0.85rem;\r\n  color: #2f5f3c;\r\n  font-weight: 500;\r\n  margin-top: 2px;\r\n`;\r\n\r\n\r\nconst UserDot = styled.div`\r\n  width: 8px;\r\n  height: 8px;\r\n  border-radius: 50%;\r\n  background: #28a745;\r\n`;\r\n\r\nconst HeaderActions = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n\r\n  @media (max-width: 768px) {\r\n    justify-content: center;\r\n    flex-wrap: wrap;\r\n    margin-top: 12px;\r\n  }\r\n`;\r\n\r\nconst Button = styled.button`\r\n  padding: 8px 16px;\r\n  border: none;\r\n  border-radius: 6px;\r\n  font-size: 0.9rem;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n\r\n  @media (max-width: 768px) {\r\n    padding: 6px 12px;\r\n    font-size: 0.8rem;\r\n    min-width: 80px;\r\n  }\r\n\r\n  &.primary {\r\n    background: linear-gradient(135deg, #28a745, #218838);\r\n    color: white;\r\n\r\n    &:hover {\r\n      background: #218838;\r\n    }\r\n  }\r\n\r\n  &.secondary {\r\n    background: #f0fff4;\r\n    color: #155724;\r\n    border: 1px solid #c3e6cb;\r\n\r\n    &:hover {\r\n      background: #e2f6e9;\r\n    }\r\n  }\r\n\r\n  &.danger {\r\n    background: #dc3545;\r\n    color: white;\r\n\r\n    &:hover {\r\n      background: #c82333;\r\n    }\r\n  }\r\n`;\r\n\r\nconst CanvasContainer = styled.div`\r\n  flex: 1;\r\n  position: relative;\r\n  overflow: hidden;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: #ffffff;\r\n`;\r\n\r\nconst LoadingOverlay = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(212, 237, 218, 0.95);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n`;\r\n\r\nconst LoadingText = styled.div`\r\n  color: #155724;\r\n  font-size: 1.1rem;\r\n`;\r\n\r\nconst SidebarOverlay = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  right: 0;\r\n  width: min(300px, 90vw);\r\n  height: 100vh;\r\n  background: #ffffff;\r\n  border-left: 1px solid #c3e6cb;\r\n  box-shadow: -2px 0 8px rgba(0,0,0,0.15);\r\n  transition: transform 0.3s ease-in-out, opacity 0.3s;\r\n  z-index: 1000;\r\n  overflow: hidden;\r\n  touch-action: pan-y;\r\n  transform: ${({ $show }) => $show ? 'translateX(0)' : 'translateX(100%)'};\r\n  opacity: ${({ $show }) => $show ? 1 : 0};\r\n  pointer-events: ${({ $show }) => $show ? 'auto' : 'none'};\r\n\r\n  @media (max-width: 768px) {\r\n    width: 100vw;\r\n    right: 0;\r\n    transform: ${({ $show }) => $show ? 'translateX(0)' : 'translateX(100vw)'};\r\n  }\r\n`;\r\n\r\nconst Backdrop = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.4);\r\n  opacity: ${props => props.$show ? '1' : '0'};\r\n  visibility: ${props => props.$show ? 'visible' : 'hidden'};\r\n  transition: all 0.3s ease-in-out;\r\n  z-index: 999;\r\n`;\r\n\r\nconst RedDot = styled.span`\r\n  display: inline-block;\r\n  width: 10px;\r\n  height: 10px;\r\n  background: #dc3545;\r\n  border-radius: 50%;\r\n  margin-left: 6px;\r\n  vertical-align: middle;\r\n`;\r\n\r\nconst ChatIcon = () => (\r\n  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n    <path d=\"M4 20V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H7l-3 3z\" stroke=\"#28a745\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" fill=\"#fff\"/>\r\n  </svg>\r\n);\r\n\r\nfunction Whiteboard() {\r\n  const { roomId } = useParams();\r\n  const navigate = useNavigate();\r\n  const {\r\n    socket, isConnected, currentRoom, users,\r\n    joinRoom, leaveRoom, sendDraw, clearCanvas,\r\n    undo, redo, socketReady\r\n  } = useSocket();\r\n\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [showSidebar, setShowSidebar] = useState(false);\r\n  const [currentUsername, setCurrentUsername] = useState('');\r\n  const [drawingSettings, setDrawingSettings] = useState({\r\n    tool: 'pen',\r\n    color: '#000000',\r\n    brushSize: 2,\r\n    opacity: 1\r\n  });\r\n  const [pendingPassword, setPendingPassword] = useState(null);\r\n  const [joinTried, setJoinTried] = useState(false);\r\n  const canvasRef = useRef(null);\r\n  const [remoteDrawEvent, setRemoteDrawEvent] = useState(null);\r\n  const [touchStart, setTouchStart] = useState(null);\r\n  const hasJoinedRef = useRef(false);\r\n  const [hasUnreadMessages, setHasUnreadMessages] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!socket) return;\r\n    const handleJoinError = (error) => {\r\n      if (error.message === 'Incorrect password' || error.message === 'Password required') {\r\n        let password = '';\r\n        while (!password) {\r\n          password = window.prompt('Enter room password:');\r\n          if (password === null) return navigate('/');\r\n        }\r\n        setPendingPassword(password);\r\n        setJoinTried(false);\r\n        hasJoinedRef.current = false;\r\n      } else {\r\n        alert(error.message);\r\n        navigate('/');\r\n      }\r\n    };\r\n    socket.on('join-error', handleJoinError);\r\n    return () => socket.off('join-error', handleJoinError);\r\n  }, [socket, navigate]);\r\n\r\n  useEffect(() => {\r\n    if (isConnected && roomId && socketReady && !hasJoinedRef.current && !joinTried) {\r\n      let username = localStorage.getItem('username') || `User${Math.floor(Math.random() * 1000)}`;\r\n      localStorage.setItem('username', username);\r\n      setCurrentUsername(username);\r\n      const isPrivate = !!pendingPassword;\r\n      joinRoom(roomId, username, isPrivate, pendingPassword || '');\r\n      setIsLoading(false);\r\n      hasJoinedRef.current = true;\r\n      setJoinTried(true);\r\n    }\r\n  }, [isConnected, roomId, joinRoom, socketReady, pendingPassword, joinTried]);\r\n\r\n  useEffect(() => {\r\n    if (socket) {\r\n      socket.on('draw', handleRemoteDraw);\r\n      socket.on('stroke', handleRemoteDraw);\r\n      socket.on('clear-canvas', handleRemoteClear);\r\n      socket.on('canvas-data', handleRemoteCanvasData);\r\n      return () => {\r\n        socket.off('draw');\r\n        socket.off('stroke');\r\n        socket.off('clear-canvas');\r\n        socket.off('canvas-data');\r\n      };\r\n    }\r\n  }, [socket]);\r\n\r\n  useEffect(() => {\r\n    if (socket && currentRoom?.roomId) {\r\n      socket.emit('request-canvas', { roomId: currentRoom.roomId });\r\n    }\r\n  }, [socket, currentRoom]);\r\n\r\n  useEffect(() => {\r\n    if (showSidebar && hasUnreadMessages) {\r\n      setHasUnreadMessages(false);\r\n    }\r\n  }, [showSidebar, hasUnreadMessages]);\r\n\r\n  useEffect(() => {\r\n    const handleBeforeUnload = () => leaveRoom();\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\r\n  }, [leaveRoom]);\r\n\r\n  const handleRemoteDraw = (data) => setRemoteDrawEvent(data);\r\n  const handleRemoteClear = () => canvasRef.current?.clear();\r\n  const handleRemoteCanvasData = ({ canvasData }) =>\r\n    canvasRef.current?.loadImageFromDataUrl(canvasData || '');\r\n\r\n  const handleDrawEvent = (drawData) =>\r\n    sendDraw({ ...drawData, roomId: currentRoom?.roomId || roomId });\r\n\r\n  const handleClearCanvas = () => clearCanvas(currentRoom?.roomId || roomId);\r\n  const handleUndo = () => undo(currentRoom?.roomId || roomId);\r\n  const handleRedo = () => redo(currentRoom?.roomId || roomId);\r\n\r\n  const handleExportImage = async () => {\r\n    if (canvasRef.current) {\r\n      try {\r\n        const dataUrl = canvasRef.current.exportImage();\r\n        const link = document.createElement('a');\r\n        link.download = `whiteboard-${roomId}-${new Date().toISOString().slice(0, 10)}.png`;\r\n        link.href = dataUrl;\r\n        link.click();\r\n      } catch (err) {\r\n        console.error(err);\r\n        alert('Failed to export image');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleExportPDF = async () => {\r\n    if (canvasRef.current) {\r\n      try {\r\n        const pdf = await canvasRef.current.exportPDF();\r\n        pdf.save(`whiteboard-${roomId}-${new Date().toISOString().slice(0, 10)}.pdf`);\r\n      } catch (err) {\r\n        console.error(err);\r\n        alert('Failed to export PDF');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleLeaveRoom = () => leaveRoom(() => setTimeout(() => navigate('/'), 0));\r\n\r\n  const copyRoomLink = () => {\r\n    navigator.clipboard.writeText(`${window.location.origin}/whiteboard/${roomId}`);\r\n    alert('Room link copied to clipboard!');\r\n  };\r\n\r\n  const handleTouchStart = (e) => setTouchStart(e.touches[0].clientX);\r\n  const handleTouchMove = (e) => {\r\n    if (!touchStart) return;\r\n    if (touchStart - e.touches[0].clientX > 50) {\r\n      setShowSidebar(false);\r\n      setTouchStart(null);\r\n    }\r\n  };\r\n  const handleTouchEnd = () => setTouchStart(null);\r\n  const handleNewSidebarMessage = () => !showSidebar && setHasUnreadMessages(true);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <LoadingOverlay>\r\n        <LoadingText>Connecting to room...</LoadingText>\r\n      </LoadingOverlay>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <WhiteboardContainer>\r\n      <MainContent>\r\n        <Header>\r\n          <RoomInfo>\r\n            <RoomTitle>CollabBoard</RoomTitle>\r\n            <RoomSubtitle>Brainstorm. Sketch. Buildâ€”Together.</RoomSubtitle>\r\n            <UserCount><UserDot /> {users?.length || 0} Users Online</UserCount>\r\n          </RoomInfo>\r\n\r\n          <HeaderActions>\r\n            <Button\r\n              className=\"secondary\"\r\n              style={{\r\n                position: 'relative', padding: '8px', borderRadius: '50%',\r\n                width: 40, height: 40, display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n              }}\r\n              onClick={() => setShowSidebar(!showSidebar)}\r\n              aria-label={showSidebar ? 'Hide chat' : 'Show chat'}>\r\n              <ChatIcon />\r\n              {!showSidebar && hasUnreadMessages && (\r\n                <RedDot style={{ position: 'absolute', bottom: 4, right: 4 }} />\r\n              )}\r\n            </Button>\r\n            <Button className=\"secondary\" onClick={copyRoomLink}>Share</Button>\r\n            <Button className=\"danger\" onClick={handleLeaveRoom}>Leave Room</Button>\r\n          </HeaderActions>\r\n        </Header>\r\n\r\n        <CanvasContainer>\r\n          <Canvas\r\n            ref={canvasRef}\r\n            tool={drawingSettings.tool}\r\n            color={drawingSettings.color}\r\n            brushSize={drawingSettings.brushSize}\r\n            opacity={drawingSettings.opacity}\r\n            onDrawEvent={handleDrawEvent}\r\n            remoteDrawEvent={remoteDrawEvent}\r\n          />\r\n        </CanvasContainer>\r\n\r\n        <Toolbar\r\n          settings={drawingSettings}\r\n          onSettingsChange={setDrawingSettings}\r\n          onClear={handleClearCanvas}\r\n          onUndo={handleUndo}\r\n          onRedo={handleRedo}\r\n          onExportImage={handleExportImage}\r\n          onExportPDF={handleExportPDF}\r\n        />\r\n      </MainContent>\r\n\r\n      <SidebarOverlay\r\n        $show={showSidebar}\r\n        onTouchStart={handleTouchStart}\r\n        onTouchMove={handleTouchMove}\r\n        onTouchEnd={handleTouchEnd}\r\n      >\r\n        <Sidebar\r\n          users={users}\r\n          roomId={roomId}\r\n          currentUsername={currentUsername}\r\n          onClose={() => setShowSidebar(false)}\r\n          onNewMessage={handleNewSidebarMessage}\r\n        />\r\n      </SidebarOverlay>\r\n\r\n      <Backdrop $show={showSidebar} onClick={() => setShowSidebar(false)} />\r\n    </WhiteboardContainer>\r\n  );\r\n}\r\n\r\nexport default Whiteboard;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}